<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏¥‡πä‡∏Å‡∏ã‡∏≠‡∏ß‡πå Perfect Edition üíñ</title>
    <meta name="description" content="‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏¥‡πä‡∏Å‡∏ã‡∏≠‡∏ß‡πå‡∏™‡∏ô‡∏∏‡∏Å ‡πÜ ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï">
    <style>
        /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏ö‡∏ö */
        body,
        h1,
        p,
        button,
        .stats,
        .description,
        a {
            font-family: 'Arial', 'Sarabun', 'Helvetica', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        :root {
            --accent: #ff6b6b;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            --glow: 0 0 30px rgba(102, 126, 234, 0.3);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 90px;
            color: #fff;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        h1 {
            color: white;
            text-align: center;
            font-size: clamp(1.5rem, 4vw, 2.6rem);
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: titlePulse 2s ease-in-out infinite alternate;
        }

        @keyframes titlePulse {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.02);
            }
        }

        .description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .stats {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            padding: 10px 18px;
            margin: 12px 0;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            text-align: center;
            width: 100%;
            max-width: 300px;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            width: 100%;
            max-width: 800px;
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (min-width: 768px) {
            .game-container {
                flex-direction: row;
                align-items: flex-start;
                gap: 32px;
            }
        }

        .preview {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            padding: 10px;
            position: relative;
            transition: all 0.3s ease;
        }

        .preview::before {
            content: "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á";
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1;
        }

        .preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }

        #puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 3px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 8px;
            box-shadow: var(--shadow);
            position: relative;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 320px;
            aspect-ratio: 1 / 1;
        }

        .puzzle-piece {
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            user-select: none;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            touch-action: manipulation;
            background-size: 300% 300%;
            overflow: hidden;
        }

        .puzzle-piece:hover {
            transform: translateY(-2px) scale(1.05);
            z-index: 10;
        }

        .selected {
            outline: 3px solid var(--accent);
            outline-offset: 2px;
            transform: translateY(-5px) scale(1.08) !important;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5), 0 8px 20px rgba(0, 0, 0, 0.3) !important;
            z-index: 100 !important;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 12px;
            width: 100%;
        }

        button {
            padding: 10px 16px;
            border: none;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            min-width: 100px;
        }

        button:hover,
        button:active {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease;
            z-index: 10;
        }

        .hint-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .hint-overlay img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .celebration-content {
            text-align: center;
            color: white;
            animation: celebrationPop 0.8s ease-out;
        }

        .celebration-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .celebration-stats {
            font-size: 1.2rem;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .celebration-button {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .celebration-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }

        @keyframes celebrationPop {
            0% {
                transform: scale(0.3) rotate(-10deg);
                opacity: 0;
            }

            50% {
                transform: scale(1.1) rotate(5deg);
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes glow {
            0% {
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }

            100% {
                text-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.8);
            }
        }

        .completion-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1500;
        }

        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: confettiFall 4s linear forwards;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkExplode 2s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(20);
                opacity: 0;
            }
        }

        .star {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 7px solid #ffd700;
            transform: rotate(35deg);
            animation: starTwinkle 3s ease-out forwards;
        }

        .star:before {
            content: '';
            position: absolute;
            left: -5px;
            top: -5px;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 7px solid #ffd700;
            transform: rotate(-70deg);
        }

        .star:after {
            content: '';
            position: absolute;
            left: -5px;
            top: 3px;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 7px solid #ffd700;
            transform: rotate(70deg);
        }

        @keyframes starTwinkle {

            0%,
            100% {
                opacity: 0;
                transform: rotate(35deg) scale(0);
            }

            50% {
                opacity: 1;
                transform: rotate(35deg) scale(1.5);
            }
        }

        .menu-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            background: linear-gradient(90deg, #ff6b9d, #e91e63, #c2185b);
            padding: 14px 28px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.5);
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
            justify-content: center;
        }

        .menu-button:hover,
        .menu-button:active {
            transform: translateX(-50%) scale(1.08);
            box-shadow: 0 10px 30px rgba(233, 30, 99, 0.6);
        }

        @media (max-width: 480px) {
            .preview img {
                width: 100px;
                height: 100px;
            }

            #puzzle-container {
                max-width: 280px;
                padding: 6px;
            }

            .controls button {
                padding: 9px 14px;
                font-size: 0.85rem;
            }

            .stats {
                font-size: 0.9rem;
            }

            .menu-button {
                font-size: 0.95rem;
                padding: 12px 24px;
                min-width: 180px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .description {
                font-size: 0.95rem;
            }

            body {
                padding: 12px;
            }

            .celebration-title {
                font-size: 2rem;
            }

            .celebration-stats {
                font-size: 1rem;
                padding: 15px;
            }
        }

        @media (max-width: 360px) {
            .preview img {
                width: 80px;
                height: 80px;
            }

            #puzzle-container {
                max-width: 240px;
            }

            .menu-button {
                font-size: 0.9rem;
                padding: 10px 20px;
                min-width: 160px;
            }

            .controls button {
                min-width: 90px;
            }

            .celebration-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>

<body>

    <h1>üß© ‡πÄ‡∏Å‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏¥‡πä‡∏Å‡∏ã‡∏≠‡∏ß‡πå Perfect Edition üíé</h1>
    <p class="description">‡πÅ‡∏ï‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏±‡∏ô!</p>

    <div class="stats">
        <span id="moves-counter">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß: 0</span>
        <span style="margin: 0 10px;">|</span>
        <span id="time-counter">‡πÄ‡∏ß‡∏•‡∏≤: 00:00</span>
    </div>

    <div class="game-container">
        <div class="preview">
            <img src="images/1.jpg" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û">
        </div>
        <div id="puzzle-container">
            <div class="hint-overlay" id="hint-overlay"></div>
        </div>
    </div>

    <div class="controls">
        <button onclick="shufflePieces()">üîÑ ‡∏™‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà</button>

        <button onclick="changeImage()">üñºÔ∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏û</button>
    </div>

    <div class="completion-effect" id="completion-effect"></div>

    <div class="celebration-overlay" id="celebration-overlay">
        <div class="celebration-content">
            <div class="celebration-title">üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! üéâ</div>
            <div class="celebration-stats" id="celebration-stats"></div>
            <button class="celebration-button" onclick="closeCelebration()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà üéÆ</button>
        </div>
    </div>

    <!-- ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô src -->
    <audio id="win-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="move-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg">
    </audio>

    <a href="menu.html" class="menu-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5"></path>
            <path d="M12 19l-7-7 7-7"></path>
        </svg>
        ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π
    </a>

    <script>
        const puzzleContainer = document.getElementById('puzzle-container');
        const previewImg = document.querySelector('.preview img');
        const winSound = document.getElementById('win-sound');
        const moveSound = document.getElementById('move-sound');
        const movesCounter = document.getElementById('moves-counter');
        const timeCounter = document.getElementById('time-counter');
        const completionEffect = document.getElementById('completion-effect');
        const hintOverlay = document.getElementById('hint-overlay');
        const celebrationOverlay = document.getElementById('celebration-overlay');
        const celebrationStats = document.getElementById('celebration-stats');

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ placeholder
        const images = [
            "images/1.jpg",
            "images/2.jpg",
            "images/3.jpg",
            "images/6.jpg",
            "images/9.jpg",
            "images/18.jpg",
        ];

        // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        // const images = [
        //     "https://picsum.photos/300/300?random=1",
        //     "https://picsum.photos/300/300?random=2",
        //     "https://picsum.photos/300/300?random=3"
        // ];

        let currentImageIndex = 0;
        const size = 3;
        let pieces = [];
        let selectedPiece = null;
        let moves = 0;
        let startTime = null;
        let timerInterval = null;
        let gameCompleted = false;

        function createPieces() {
            puzzleContainer.innerHTML = '';
            pieces = [];

            for (let i = 0; i < size * size; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.style.backgroundImage = `url(${images[currentImageIndex]})`;
                piece.style.backgroundSize = `${size * 100}% ${size * 100}%`;
                piece.style.backgroundPosition = `${-(i % size) * 100}% ${-Math.floor(i / size) * 100}%`;
                piece.dataset.correctIndex = i;
                piece.dataset.currentIndex = i;

                // ‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                piece.addEventListener('click', handlePieceClick);

                pieces.push(piece);
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô container
            pieces.forEach(piece => puzzleContainer.appendChild(piece));
        }

        function handlePieceClick() {
            if (gameCompleted) return;
            if (!startTime) startTimer();

            if (!selectedPiece) {
                selectedPiece = this;
                this.classList.add('selected');
            } else if (selectedPiece === this) {
                this.classList.remove('selected');
                selectedPiece = null;
            } else {
                swapPieces(selectedPiece, this);
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
            }
        }

        function swapPieces(piece1, piece2) {
            if (piece1 === piece2) return;

            const index1 = pieces.indexOf(piece1);
            const index2 = pieces.indexOf(piece2);

            // ‡∏™‡∏•‡∏±‡∏ö‡πÉ‡∏ô array
            [pieces[index1], pieces[index2]] = [pieces[index2], pieces[index1]];

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï dataset
            const tempIndex = piece1.dataset.currentIndex;
            piece1.dataset.currentIndex = piece2.dataset.currentIndex;
            piece2.dataset.currentIndex = tempIndex;

            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä DOM
            puzzleContainer.innerHTML = '';
            pieces.forEach(p => {
                puzzleContainer.appendChild(p);
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å event ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà append
                p.addEventListener('click', handlePieceClick);
            });

            // ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô
            piece1.style.transform = 'scale(1.2) rotate(5deg)';
            piece2.style.transform = 'scale(1.2) rotate(-5deg)';
            setTimeout(() => {
                piece1.style.transform = '';
                piece2.style.transform = '';
            }, 300);

            updateMoves();
            playMoveSound();
            checkWin();
        }

        function shufflePieces() {
            if (gameCompleted) return;

            gameCompleted = false;
            moves = 0;
            updateMoves();
            resetTimer();

            if (selectedPiece) {
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
            }

            // ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö
            for (let i = pieces.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pieces[i], pieces[j]] = [pieces[j], pieces[i]];
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ñ‡∏π‡∏Å
            if (isSolved()) {
                [pieces[0], pieces[1]] = [pieces[1], pieces[0]];
            }

            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä DOM + ‡∏ú‡∏π‡∏Å event ‡πÉ‡∏´‡∏°‡πà
            puzzleContainer.innerHTML = '';
            pieces.forEach(p => {
                p.dataset.currentIndex = pieces.indexOf(p);
                puzzleContainer.appendChild(p);
                p.addEventListener('click', handlePieceClick);
            });
        }

        function isSolved() {
            return pieces.every((piece, index) =>
                parseInt(piece.dataset.correctIndex) === parseInt(piece.dataset.currentIndex)
            );
        }

        function checkWin() {
            if (isSolved() && !gameCompleted) {
                gameCompleted = true;
                clearInterval(timerInterval);
                setTimeout(() => {
                    showMegaCelebration();
                    playWinSound();
                }, 300);
            }
        }

        function showMegaCelebration() {
            const finalTime = timeCounter.textContent.split(': ')[1];
            celebrationStats.innerHTML = `
                <div>üèÜ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πà‡∏≠‡∏à‡∏¥‡πä‡∏Å‡∏ã‡∏≠‡∏ß‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! üèÜ</div>
                <div style="margin-top: 15px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <strong>${finalTime}</strong></div>
                <div>üéØ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß: <strong>${moves}</strong> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                <div style="margin-top: 10px;">‚ú® ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: <strong>${calculateScore()}</strong>/100</div>
            `;
            celebrationOverlay.style.display = 'flex';
            showAdvancedEffects();
        }

        function calculateScore() {
            const timeInSeconds = (Date.now() - startTime) / 1000;
            const timeScore = Math.max(0, 100 - timeInSeconds / 2);
            const moveScore = Math.max(0, 100 - moves * 3);
            return Math.round((timeScore + moveScore) / 2);
        }

        function showAdvancedEffects() {
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.background = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f093fb', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'][Math.floor(Math.random() * 8)];
                    confetti.style.animationDelay = Math.random() * 1 + 's';
                    confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                    completionEffect.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 20);
            }

            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = (20 + Math.random() * 60) + 'vw';
                    firework.style.top = (20 + Math.random() * 40) + 'vh';
                    firework.style.background = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f093fb'][Math.floor(Math.random() * 4)];
                    completionEffect.appendChild(firework);
                    setTimeout(() => firework.remove(), 2000);
                }, i * 400);
            }

            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + 'vw';
                    star.style.top = Math.random() * 100 + 'vh';
                    star.style.animationDelay = Math.random() * 2 + 's';
                    completionEffect.appendChild(star);
                    setTimeout(() => star.remove(), 3000);
                }, i * 150);
            }
        }

        function closeCelebration() {
            celebrationOverlay.style.display = 'none';
            initGame();
        }

        function updateMoves() {
            moves++;
            movesCounter.textContent = `‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß: ${moves}`;
        }

        function startTimer() {
            if (startTime) return;
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                timeCounter.textContent = `‡πÄ‡∏ß‡∏•‡∏≤: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function resetTimer() {
            if (timerInterval) clearInterval(timerInterval);
            startTime = null;
            timeCounter.textContent = '‡πÄ‡∏ß‡∏•‡∏≤: 00:00';
        }

        function playMoveSound() {
            moveSound.currentTime = 0;
            moveSound.play().catch(e => console.log("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ", e));
        }

        function playWinSound() {
            winSound.currentTime = 0;
            winSound.play().catch(e => console.log("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ", e));
        }

        function toggleHint() {
            if (hintOverlay.classList.contains('show')) {
                hintOverlay.classList.remove('show');
                setTimeout(() => hintOverlay.innerHTML = '', 300);
            } else {
                const img = document.createElement('img');
                img.src = images[currentImageIndex];
                img.alt = '‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ';
                img.onload = () => {
                    hintOverlay.appendChild(img);
                    hintOverlay.classList.add('show');
                    setTimeout(() => {
                        hintOverlay.classList.remove('show');
                        setTimeout(() => hintOverlay.innerHTML = '', 300);
                    }, 3000);
                };
                img.onerror = () => {
                    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå images/ ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå 1.jpg, 2.jpg, 3.jpg");
                };
            }
        }

        function changeImage() {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            previewImg.src = images[currentImageIndex];
            initGame();
            if (hintOverlay.classList.contains('show')) {
                hintOverlay.classList.remove('show');
                setTimeout(() => hintOverlay.innerHTML = '', 300);
            }
        }

        function initGame() {
            createPieces();
            shufflePieces();
            resetTimer();
            moves = 0;
            updateMoves();
            gameCompleted = false;
        }

        // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
        document.addEventListener('keydown', (e) => {
            if (e.key === 'h' || e.key === 'H') toggleHint();
            else if (e.key === 's' || e.key === 'S') shufflePieces();
            else if (e.key === 'c' || e.key === 'C') changeImage();
            else if (e.key === 'Escape' && celebrationOverlay.style.display === 'flex') closeCelebration();
        });

        // ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤
        document.addEventListener('contextmenu', e => e.preventDefault());

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>

</html>